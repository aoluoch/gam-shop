name: Supabase

on:
  push:
    branches: [main]
    paths:
      - 'supabase/**'
  pull_request:
    branches: [main]
    paths:
      - 'supabase/**'
  workflow_dispatch:

jobs:
  validate:
    name: Validate SQL Files
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Validate SQL files exist
        run: |
          echo "## ðŸ“‹ Supabase Files Check" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ -f "supabase/schema.sql" ]; then
            echo "âœ… Schema file found" 
            echo "- âœ… \`supabase/schema.sql\` exists" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ No schema.sql file"
            echo "- âš ï¸ \`supabase/schema.sql\` not found" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ -f "supabase/seed.sql" ]; then
            echo "âœ… Seed file found"
            echo "- âœ… \`supabase/seed.sql\` exists" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ No seed.sql file"
            echo "- âš ï¸ \`supabase/seed.sql\` not found" >> $GITHUB_STEP_SUMMARY
          fi

      - name: Check SQL syntax
        run: |
          for file in supabase/*.sql; do
            if [ -f "$file" ] && [ -s "$file" ]; then
              echo "Checking $file..."
              # Basic syntax check - ensure file is readable
              head -n 5 "$file"
              echo "---"
            fi
          done
